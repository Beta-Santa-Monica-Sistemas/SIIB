@model IEnumerable<Beta_System.Models.C_modulos>

<div class="porcentaje-container row">
    @foreach (var modulo in Model.OrderBy(x => x.nombre).GroupBy(x => x.IdModulo))
    {
        <div class="col-md-4">
            <div class="porcentaje-card">
                <div class="col-md-2 ">
                    <lord-icon src="@modulo.FirstOrDefault().icono"
                               trigger="in"
                               delay="500"
                               @*state="in-reveal"*@
                               style="width:50px;height:32px">
                    </lord-icon>
                </div>
                <div class="col-md-10 bg-beta text-left">
                    <h3 class="p-2 text-white" style="margin:0px;">@modulo.FirstOrDefault().nombre</h3>
                </div>

                <div class="table-responsive" style="overflow:auto; overflow-x:hidden; height:200px; min-height:200px;">
                    <table class="table table-striped table-hover">
                        <thead>
                        </thead>
                        <tbody>
                            @foreach (var sub_modulo in modulo.FirstOrDefault().C_modulos_sub.Where(x => x.aplica_submenu == false && x.id_submenu_modulo_sub == null).OrderBy(x => x.nombre))
                            {
                                int aplica_submenu = Convert.ToInt32(sub_modulo.aplica_submenu);
                                int id_sub_submenu = 0;
                                if (sub_modulo.id_submenu_modulo_sub != null) { id_sub_submenu = (int)sub_modulo.id_submenu_modulo_sub; }
                                <tr class="text-center">
                                    <td class="text-left" style="width: 80%;">@sub_modulo.nombre</td>
                                    <td>
                                        @if (sub_modulo.activo == true)
                                        {<i class="fa fa-2x fa-toggle-on" style="color:lawngreen;"></i> }
                                        else
                                        { <i class="fa fa-2x fa-toggle-off" style="color:grey;"></i>}
                                    </td>
                                    <td>
                                        <button class="btn btn_beta_lineal" onclick="EditarInfoSubModulo(@sub_modulo.id_modulos_sub, @sub_modulo.id_modulo, '@sub_modulo.nombre', '@sub_modulo.funcion', '@sub_modulo.controlador', '@aplica_submenu', '@id_sub_submenu' );"><i class="fa fa-edit"></i></button>
                                    </td>
                                </tr>
                            }

                            @foreach (var sub_modulo in modulo.FirstOrDefault().C_modulos_sub.Where(x => x.aplica_submenu == true).OrderBy(x => x.nombre))
                            {
                                <tr>
                                    <td colspan="3" class="bg-dark text-white">@sub_modulo.nombre</td>
                                </tr>
                                foreach (var item_submodulo in modulo.FirstOrDefault().C_modulos_sub.Where(x => x.id_submenu_modulo_sub == sub_modulo.id_modulos_sub && x.aplica_submenu == false))
                                {
                                    int aplica_submenu = Convert.ToInt32(item_submodulo.aplica_submenu);
                                    int id_sub_submenu = 0;
                                    if (item_submodulo.id_submenu_modulo_sub != null) { id_sub_submenu = (int)item_submodulo.id_submenu_modulo_sub; }
                                    <tr class="text-center">
                                        <td class="text-left" style="width: 80%;">@item_submodulo.nombre</td>
                                        <td>
                                            @if (item_submodulo.activo == true)
                                            {<i class="fa fa-2x fa-toggle-on" style="color:lawngreen;"></i> }
                                            else
                                            { <i class="fa fa-2x fa-toggle-off" style="color:grey;"></i>}
                                        </td>
                                        <td>
                                            <button class="btn btn_beta_lineal" onclick="EditarInfoSubModulo(@item_submodulo.id_modulos_sub, @item_submodulo.id_modulo, '@item_submodulo.nombre', '@item_submodulo.funcion', '@item_submodulo.controlador', '@aplica_submenu', '@id_sub_submenu' );"><i class="fa fa-edit"></i></button>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
                <div class="row">
                    <div class="col-md-6 text-center">
                        <button class="btn btn_beta_icon" onclick="EditarInfoSubModulo(0, @modulo.FirstOrDefault().IdModulo, '', '', '', 0, 0 );"><i class="fa fa-plus"></i></button>
                    </div>
                    <div class="col-md-6 text-center">
                        <button class="btn btn_beta_icon" onclick="EditarInfoModulo('@modulo.FirstOrDefault().nombre', '@modulo.FirstOrDefault().icono', @modulo.FirstOrDefault().IdModulo);"><i class="fa fa-edit"></i></button>
                    </div>
                </div>
            </div>
        </div>
    }
</div>



