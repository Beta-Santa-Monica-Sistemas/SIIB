
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/MainLayout.cshtml";
    List<int> permisos = Session["PermisosModulo"] as List<int>;
}

<style>
    #ui-id-1 {
        z-index: 999999;
    }
    #ui-id-2 {
        z-index: 999999;
    }


</style>

<div class="page_title">
    <div class="counter_section">
        <div class="row">
            <h1>Modificación de requisiciones</h1>
        </div>
    </div>
</div>


<div class="column2 counter_section">
    <div class="row">
        <div class="col-md-3">
            <h3 class="mt-3"><strong>Folio/No. de requisición:</strong></h3>
        </div>
        <div class="col-md-2">
            <input class="form-control" placeholder="Ingrese el folio" id="folio_requi_buscar" />
        </div>
        <div class="col-md-1">
            <button class="btn btn_beta_icon" onclick="BuscarInformacionRequisicionUtileria();"><i class="fa fa-search"></i></button>
        </div>
    </div>
    <hr />


    @if (permisos.Contains(4067))
    {
        <div class="col-md-12 text-right" style="display:none" id="div_cancelar_requi">
            <button class="btn btn_beta_danger" id="btn_cancelar_requi" onclick="CancelarRequisicionUtilerias();">CANCELAR REQUISICION</button>
            <hr />
        </div>
    }


    <div class="row">
        <div class="col-md-6">
            <table class="table table-striped table-bordered w-100 text-center">
                <tr>
                    <td><strong>Centro: </strong><input id="id_centro_g_editar" style="display:none" />  </td>
                    <td>
                        <strong id="select_centro_edit"></strong>
                    </td>
                </tr>
                <tr>
                    <td><strong>Tipo de requisición:</strong> <input id="id_tipo_requisicion" style="display:none" /></td>
                    <td><strong id="txt_tipo_requi_editar"></strong></td>
                </tr>
                <tr>
                    <td><strong>Usuario registró</strong></td>
                    <td><strong id="txt_usuario_registro_edit"></strong></td>
                </tr>
                <tr>
                    <td><strong>Fecha registró:</strong></td>
                    <td><strong id="txt_fecha_registro_edit"></strong></td>
                </tr>
                <tr>
                    <td><strong>Estatus</strong></td>
                    <td><strong id="txt_estatus_edit"></strong></td>
                </tr>
            </table>
        </div>
        <div class="col-md-6">
            <table class="table table-striped table-bordered w-100 text-center">
                <tr>
                    <td><strong>Concepto: </strong></td>
                    <td><input id="txt_concepto_requi_editar" type="text" class="form-control" /></td>
                </tr>
                <tr>
                    <td><strong>Prioridad: </strong></td>
                    <td><select class="form-control " id="select_prioridad_edit">@{ Html.RenderAction("ConsultarPrioriedadSelect", "CATALOGOS"); };</select></td>
                </tr>

                <tr style="display:none" id="tr_update_header_requi">
                    <td><strong>Actualizar datos</strong></td>
                    <td class="text-center"><button class="btn btn_beta_icon" id="btn_update_header_requi"><i class="fa fa-check"></i></button></td>
                </tr>
            </table>
        </div>
    </div>
    <hr />
    <div id="div_informacion_requisicion">

    </div>
</div>


<!-- MODAL EDITAR ARTICULO REQUISICION -->
<div class="modal fade" id="m_editar_articulo_utileria" tabindex="-1" role="dialog" aria-labelledby="editar_articulo_utileriaLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="min-width:50%; width:50%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editar_articulo_utileriaLabel">Editar articulo requisición</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col-md-12 text-center">
                    <h4 style="margin:5px;">Articulo a modificar:</h4>
                    <h3 style="margin:5px;" id="txt_nombre_articulo_ediar"></h3>
                    <hr />
                    <strong>Cargo contable</strong>
                    <select class="form-control" id="select_cargo_editar" onchange="ConsultarCuentasContablesCargosSelectUtileria();">
                        <option value="select_cargo">SELECCIONAR CARGO CONTABLE</option>
                        @{ Html.RenderAction("ConsultarCargosContables", "CATALOGOS"); };
                    </select>
                    <br />
                    <strong>Cuenta contable </strong>
                    <select class="form-control select_cuenta" id="select_cuenta_editar">
                        <option value="selecte_cuenta">SELECCIONAR CUENTA</option>
                    </select>
                    <br />
                    <strong>Cantidad:</strong>
                    <input type="number" id="cantidad_articulo_editar" class="form-control" />
                    <br />
                    <strong>Observaciones</strong>
                    <textarea id="obsercacion_articulo_editar" rows="3" class="form-control"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn_beta_danger" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn_beta" id="btn_actualizar_articulo_editar">Actualizar</button>
            </div>
        </div>
    </div>
</div>




<!-- MODAL EDITAR ORDEN DE COMPRA -->
<div class="modal fade" id="m_editar_orden_compra" tabindex="-1" role="dialog" aria-labelledby="editar_orden_compraLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="min-width:98%; width:98%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editar_orden_compraLabel">Editar orden de compra</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="text-center">
                            <h4 style="margin:5px;">Orden de compra a modificar:</h4>
                            <h3 style="margin:5px;" id="txt_id_orden_compra_oc"></h3>
                            <hr />
                        </div>
                        <div class="col-md-12 text-center">
                            <strong>Proveedor</strong>
                            <input class="form-control" id="id_proveedor_editar_oc" type="text" name="id_proveedor_editar_oc" />
                            <br />
                        </div>
                        <div class="col-md-12 text-center">
                            <strong>Ubicación de entrega:</strong>
                            <select class="form-control" id="ubicacion_entrega_editar_oc">
                                @{ Html.RenderAction("ConsultarUbicacionesEntrega", "CATALOGOS"); }
                            </select>
                            <hr />
                            <strong>Justificación</strong>
                            <textarea class="form-control" rows="4" id="justificacion_editar_oc"></textarea>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div id="div_detalle_oc_editar"></div>
                    </div>
                </div>



            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn_beta_danger" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn_beta" id="btn_actualizar_oc_editar">Actualizar</button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL EDITAR CARGO Y CUENTA ORDEN DE COMPRA -->
<div class="modal fade" id="m_editar_orden_carg_cta" tabindex="-1" role="dialog" aria-labelledby="editar_orden_carg_ctaLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="min-width:50%; width:50%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editar_orden_carg_ctaLabel">Editar cuentas y cargos de la orden de compra</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col-md-12 text-center">
                    <h4 style="margin:5px;">Articulo a modificar:</h4>
                    <h3 style="margin:5px;" id="txt_nombre_articulo_ediar_cargo_cta"></h3>
                    <hr />
                    <strong>Cargo contable</strong>
                    <select class="form-control" id="select_cargo_editar_orden" onchange="ConsultarCuentasContablesCargosSelectUtileriaOrden();">
                        <option value="select_cargo_orden">SELECCIONAR CARGO CONTABLE</option>
                        @{ Html.RenderAction("ConsultarCargosContables", "CATALOGOS"); };
                    </select>
                    <br />
                    <strong>Cuenta contable </strong>
                    <select class="form-control" id="select_cuenta_editar_orden"></select>
                    <br />
                    <strong>Justificación</strong>
                    <textarea id="justificacion_articulo_editar_orden" rows="3" class="form-control"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn_beta_danger" data-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn_beta" id="btn_actualizar_articulo_editar_orden">Actualizar</button>
            </div>
        </div>
    </div>
</div>


<!-- MODAL DIVIDIR ORDEN DE COMPRA -->
<div class="modal fade" id="m_dividir_orden_compra" tabindex="-1" role="dialog" aria-labelledby="dividir_orden_compraLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="min-width:98%; width:98%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dividir_orden_compraLabel">Dividir orden de compra</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="div_orden_dividir"></div>

            </div>
        </div>
    </div>
</div>


<!-- MODAL MOVER ARTICULOS ORDEN DE COMPRA -->
<div class="modal fade" id="m_div_orden_mover_art" tabindex="-1" role="dialog" aria-labelledby="div_orden_mover_artLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="min-width:98%; width:98%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="div_orden_mover_artLabel">Mover artículos de orden de compra</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="div_orden_mover_art"></div>

            </div>
        </div>
    </div>
</div>




<!-- MODAL CAMBIO DE ARTÍCULO ORDEN DE COMPRA -->
<div class="modal fade" id="m_editar_orden_compra_articulo" tabindex="-1" role="dialog" aria-labelledby="editar_orden_compra_articuloLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editar_orden_compra_articuloLabel">Cambio de artículo en orden de compra</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col-md-12 text-center">
                    <div class="text-center">
                        <h2 style="margin:5px;">Artículo a modificar:</h2>
                        <h3 style="margin:5px;" id="txt_articulo_orden_compra_cambiar"></h3>
                    </div>
                </div>
                <div class="col-md-12 text-center">
                    <hr />
                    <h4>Nuevo artículo:</h4>
                    <input class="form-control" id="articulo_editar_oc_articulo" type="text" name="articulo_editar_oc_articulo" onkeyup="ValidarArticuloNuevoEditarOrdenCompra();" />
                    <strong>(ID)</strong>
                    <input type="number" id="id_articulo_editar_oc_articulo" readonly disabled />
                </div>
                <hr />
                <div class="col-md-12 text-center">
                    <hr />
                    <strong>Justificación:</strong>
                    <textarea class="form-control" rows="4" id="justificacion_editar_oc_articulo"></textarea>
                </div>
                <hr />
                <div class="text-center">
                    <button class="btn btn_beta" id="btn_editar_oc_articulo">Cambiar articulo</button>
                </div>
            </div>
        </div>
    </div>
</div>







<!--Modal LUPA Articulos-->
<div class="modal fade" id="m_lupa_articulos" tabindex="-1" role="dialog" aria-labelledby="m_lupa_articulos" aria-hidden="true">
    <div class="modal-dialog" role="document" style="min-width:40%; max-height:80%;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="m_lupa_articulos_lbl">Lista de articulos</h2>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="col-md-4">
                    <strong>Clasificación</strong>
                    <select class="form-control " id="id_clasificaciones_art" onchange="LupaArticuloParametro(1);">
                        <option value="-1">NINGUNA</option>
                        <option value="0">TODAS</option>
                        @{ Html.RenderAction("ConsultarClasificacionSelect", "ARTICULOS"); };
                    </select>
                </div>
                <div id="div_lupa_articulos"></div>
            </div>

            <div class="col-md-12">
                <label id="mensaje_prueba"></label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<!--Modal LUPA Proveedor-->
<div class="modal fade" id="m_lupa_proveedor" tabindex="-1" role="dialog" aria-labelledby="m_lupa_proveedor" aria-hidden="true">
    <div class="modal-dialog" role="document" style="min-width:75%;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="m_lupa_proveedor_lbl">Lista de proveedores</h2>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="div_lupa_proveedor"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>






@Scripts.Render("~/bundles_UtileriaRequisicionesV1.1/js")
@Scripts.Render("~/bundles_SolicitudesMercancia/js")
@Scripts.Render("~/bundles_Articulos/js")
@Scripts.Render("~/bundles_Requisiciones/js")
@Scripts.Render("~/bundles_Propiedades/js")
@Scripts.Render("~/bundles_Proveedores/js")
@Scripts.Render("~/bundles_OrdenesCompra/js")

<script>
    var id_cotizacion_servicio = 0;
    var count_articulos_detalle = 0;
    var count_tabla = 0;

    $("#id_proveedor_editar_oc").autocomplete({
        source: function (request, response) {
            $.ajax({
                type: "POST",
                async: true,
                url: "../PROVEEDORES/ConsultarProveedoresArray",
                data: {
                    search: $("#id_proveedor_editar_oc").val()
                },
                success: function (data) {
                    var data2 = $.parseJSON(data);
                    response($.map(data2, function (item) {
                        //return { label: item.razon_social, value: item.id_compras_proveedor };
                        return {
                            label: item.razon_social + " (" + item.clave_fiscal + ")", value: item.id_compras_proveedor + '|' + item.razon_social
                        };
                    }))
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }
    });


    $("#articulo_editar_oc_articulo").autocomplete({
        source: function (request, response) {
            $("#id_articulo_editar_oc_articulo").val('');
            var id_tipo_requi = $("#id_tipo_requisicion_utileria").val();
            if (id_tipo_requi == 2) {
                id_tipo_requi = 2;
            }
            else {
                id_tipo_requi = 1;
            }
            $.ajax({
                type: "POST",
                async: false,
                url: "../ARTICULOS/ConsultarArticulosArray",
                data: {
                    search: $("#articulo_editar_oc_articulo").val(),
                    id_tipo: id_tipo_requi,
                    almacenable: 0
                },
                success: function (data) {
                    var data2 = $.parseJSON(data);
                    response($.map(data2, function (item) {
                        $("#id_articulo_editar_oc_articulo").val(item.id_articulo);
                        return { label: item.clave + ' | ' + item.nombre_articulo, value: item.clave + ' | ' + item.nombre_articulo };
                    }))
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });
        }
    });
</script>



