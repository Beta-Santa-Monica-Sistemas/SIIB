@model IEnumerable<Beta_System.Models.C_almacen_solicitudes_mercancia_d>

@{
    List<int> permisos = Session["PermisosModulo"] as List<int>;
    int id_almacen = Model.FirstOrDefault().C_almacen_solicitudes_mercancia_g.C_almacen_almacenes_g.id_almacen_g;
}


@if (Model.Count() > 0)
{
    var solicitud = Model.FirstOrDefault().C_almacen_solicitudes_mercancia_g;

    <div class="">
        <div class="row">
            <div class="col-md-6 text-left">
                <h3 style="margin:0px;"><strong>Folio: #@solicitud.id_solicitud_mercancia_g</strong></h3>
                <h3 style="margin:0px;">Cargo: @solicitud.cargo_desc</h3>
            </div>
            <div class="col-md-6 text-right">
                <strong>Fecha de registro: @String.Format(solicitud.fecha_registro.ToString(), "dd/MM/yyyy")</strong><br />
                <button class="btn" style="color:white; background-color:@solicitud.C_almacen_solicitudes_status.color">@solicitud.C_almacen_solicitudes_status.nombre_status</button>
                @if (solicitud.autorizada == true && (solicitud.id_status_solicitud == 4 || solicitud.id_status_solicitud == 2))  //AUTORIZADO o LEIDO
                {
                    <br />
                    <button class="btn btn_beta" onclick="GenerarValePDF(@solicitud.id_solicitud_mercancia_g, 'div_solicitud_mercancia_vale_detalle');"><strong>Imprimir <i class="fa fa-print"></i></strong></button>
                }
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <label>Centro: <strong>@solicitud.C_centros_g.nombre_centro</strong></label><br />
                <label>Departamento: <strong>@solicitud.C_departamentos_g.nombre_departamento</strong></label><br />
                <label>Almacén: <strong>@solicitud.C_almacen_almacenes_g.nombre_almacen</strong></label><br />
                <label>Equipo: <strong>@solicitud.C_establos_equipos.clave_equipo</strong> @solicitud.C_establos_equipos.nombre_equipo</label><br />

                @try
                {
                    if (solicitud.C_alimentacion_productores != null)
                    {
                        <strong>Productor: <strong class="text_beta">@solicitud.C_alimentacion_productores.nombre_productor</strong></strong>
                        <br />
                        <strong>Origen: <strong class="text_beta">@solicitud.C_alimentacion_productores.C_alimentacion_productores_origenes.nombre_origen</strong></strong>
                    }
                }
                catch (Exception)
                {
                }
            </div>
            <div class="col-md-4">
                <label>Registrado por: <strong>@solicitud.C_empleados.nombres @solicitud.C_empleados.apellido_paterno</strong></label><br />
                @try
                {
                    if (solicitud.id_empleado_remitente != null)
                    {
                        <label>Solicita: <strong>@solicitud.C_nomina_empleados.Nombres @solicitud.C_nomina_empleados.Apellido_paterno</strong></label><br />
                    }
                    else
                    {
                        <label>Solicita: <strong>@solicitud.C_empleados.nombres @solicitud.C_empleados.apellido_paterno</strong></label><br />
                    }
                }
                catch (Exception){}


                @if (solicitud.C_usuarios_corporativo1 != null)
                {
                    <label>Autorizado por: <strong>@solicitud.C_usuarios_corporativo1.C_empleados.nombres @solicitud.C_usuarios_corporativo1.C_empleados.apellido_paterno</strong></label><br />
                }

                @if (solicitud.C_usuarios_corporativo2 != null)
                {
                    <label>Surtió: <strong>@solicitud.C_usuarios_corporativo2.C_empleados.nombres @solicitud.C_usuarios_corporativo2.C_empleados.apellido_paterno</strong></label>
                }
            </div>
            <div class="col-md-2">
                <br />
                <br />
                <h3 style="margin: 3px;"><strong>Total: $@solicitud.total.Value.ToString("N2")</strong></h3>
            </div>
        </div>
        <hr />
        <h4 class="text-center">ARTICULOS</h4>
        <div class="table-responsive">
            <table class="table table-striped table-bordered" id="tabla_solicitudes_detalle" style="width:100%;">
                <thead>
                    <tr class="text-center bg-beta">
                        <th>Artículo</th>
                        <th>Descripción</th>
                        <th>Unidad</th>
                        <th>Solicitado</th>
                        <th>Entregado</th>
                        <th>Precio Est</th>
                        <th>Importe</th>
                        <th>Cargo Contable</th>
                        <th>Observaciones</th>
                        <th>Ubicación</th>
                        <th>Entregado</th>
                        <th>Pendiente</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.OrderBy(x => x.C_articulos_catalogo.nombre_articulo))
                    {
                    <tr class="text-center">
                        <td>@item.C_articulos_catalogo.clave</td>
                        <td>@item.C_articulos_catalogo.nombre_articulo</td>
                        <td>@item.C_unidades_medidas.unidad_medida</td>
                        <td>@item.cantidad</td>
                        <td>@item.cantidad_entregada</td>

                        <td>@string.Format("{0:C}", @item.costo)</td>
                        <td>@string.Format("{0:C}", @item.importe)</td>


                        <td>@item.cargo_cuenta_contable</td>
                        <td>@item.observaciones</td>

                        <td>
                            @try
                            {
                                if (item.C_articulos_catalogo.C_inventario_almacenes_articulos.Count() > 0)
                                {
                                    var valid_establo = item.C_articulos_catalogo.C_inventario_almacenes_articulos.Where(x => x.id_almacen == id_almacen && x.activo == true);
                                    if (valid_establo != null)
                                    {
                                        <strong class="text-success">@valid_establo.FirstOrDefault().C_almacen_ubicaciones_articulos.nombre_ubicacion</strong>
                                    }
                                    else
                                    {
                                        <strong class="text-danger">NO ASIGNADA</strong>
                                    }
                                }
                                else
                                {
                                    <strong class="text-danger">NO ASIGNADA</strong>
                                }
                            }
                            catch (Exception)
                            {
                                <strong class="text-danger">NO ASIGNADA</strong>
                            }
                        </td>

                        <td>
                            @if (item.entregado == true)
                            {<strong><i class="fa fa-check"></i></strong>}
                        </td>
                        <td>
                            @if (item.entregado == false)
                            {<strong><i class="fa fa-check"></i></strong>}
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
        <br />
        <hr />
        <div class="table-responsive">
            <div id="div_solicitud_mercancia_vale_detalle"></div>
        </div>

        @if (solicitud.autorizada == null)
        {
            if (permisos.Contains(16))
            {
                <button class="btn btn_beta" onclick="AutorizarSolicitud(@solicitud.id_solicitud_mercancia_g);">Autorizar <i class="fa fa-check"></i></button>

                <button class="btn btn_beta_danger" onclick="CancelarVale(@solicitud.id_solicitud_mercancia_g, 1);">Rechazar vale <i class="fa fa-remove"></i></button>

            }
        }

    </div>

}

