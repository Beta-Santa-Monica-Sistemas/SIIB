@model Beta_System.Models.C_almacen_solicitudes_mercancia_g

@if (Model != null)
{
    <h2 class="text-center text_beta">GENERAR DEVOLUCIÓN</h2>
    <hr />
    <div class="row">
        <div class="col-md-5 text-left">
            <h3 style="margin:0px;"><strong>Folio: #@Model.id_solicitud_mercancia_g</strong></h3>
        </div>
        <div class="col-md-5 text-left">
            <h3 style="margin:0px;">Cargo: @Model.cargo_desc</h3>
        </div>
        <div class="col-md-2 text-right">
            <strong>Fecha de registro: @String.Format(Model.fecha_registro.ToString(), "dd/MM/yyyy")</strong><br />
        </div>
    </div>
    <div class="row">
        <div class="col-md-5 text-left">
            <label>Centro: <strong>@Model.C_centros_g.nombre_centro</strong></label><br />
            <label>Departamento: <strong>@Model.C_departamentos_g.nombre_departamento</strong></label><br />
            <label>Almacén: <strong>@Model.C_almacen_almacenes_g.nombre_almacen</strong></label><br />
            <label>Equipo:  <strong>@Model.C_establos_equipos.clave_equipo</strong> @Model.C_establos_equipos.nombre_equipo</label>
        </div>
        <div class="col-md-5 text-left">
            <label>Registrado por: <strong>@Model.C_empleados.nombres @Model.C_empleados.apellido_paterno</strong></label><br />
            @try
            {
                if (Model.id_empleado_remitente != null)
                {
                    <label>Solicita: <strong>@Model.C_nomina_empleados.Nombres @Model.C_nomina_empleados.Apellido_paterno</strong></label><br />
                }
                else
                {
                    <label>Solicita: <strong>@Model.C_empleados.nombres @Model.C_empleados.apellido_paterno</strong></label><br />
                }
            }
            catch (Exception) { }

            @if (@Model.C_usuarios_corporativo1 != null)
            {
                <label>Autorizado por: <strong>@Model.C_usuarios_corporativo1.C_empleados.nombres @Model.C_usuarios_corporativo1.C_empleados.apellido_paterno</strong></label><br />
            }

            @if (@Model.C_usuarios_corporativo2 != null)
            {
                <label>Surtió completo: <strong>@Model.C_usuarios_corporativo2.C_empleados.nombres @Model.C_usuarios_corporativo2.C_empleados.apellido_paterno</strong></label>
            }
        </div>
        <div class="col-md-2 text-right">
            <strong>Imprimir</strong>
            <button class="btn btn_beta_icon" onclick="GenerarValePDF(@Model.id_solicitud_mercancia_g, 'div_devolucion_vale');"><i class="fa fa-print"></i></button>
            <button class="btn" style="color:white; background-color:@Model.C_almacen_solicitudes_status.color">@Model.C_almacen_solicitudes_status.nombre_status</button>
            <h3 style="margin: 2px;"><strong>Total: $@Model.total</strong></h3>
        </div>
    </div>
    <hr />
    <h3 class="text-center">DETALLE DEL VALE</h3>
    <table class="table table-striped table-bordered">
        <thead>
            <tr class="bg-beta text-center">
                <th><strong>Clave</strong></th>
                <th class="text-left" style="width:300px;"><strong>Artículo</strong></th>
                <th><strong>Cantidad</strong></th>
                <th><strong>Cantidad entregada</strong></th>
                <th><strong>Costo</strong></th>
                <th><strong>Importe ($)</strong></th>
                <th><strong>Cuenta</strong></th>
                <th><strong>Cargo</strong></th>
                <th><strong>Devolver el articulo</strong></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.C_almacen_solicitudes_mercancia_d_logs.GroupBy(x => x.id_solicitud_mercancia_d))
            {
                <tr class="text-center bg-green">
                    <td><strong>@item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.C_articulos_catalogo.clave</strong></td>
                    <td class="text-left" style="width:300px;"><strong>@item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.C_articulos_catalogo.nombre_articulo</strong></td>
                    <td><strong>@item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.cantidad.Value.ToString("N2")</strong></td>
                    <td><strong>@item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.cantidad_entregada.Value.ToString("N2")</strong></td>
                    <td><strong>$@item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.costo.Value.ToString("N2")</strong></td>
                    <td><strong>$@item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.importe.Value.ToString("N2")</strong></td>
                    <td><strong>@item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.C_cargos_contables_g.nombre_cargo</strong></td>
                    <td><strong>@item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.C_cuentas_contables_g.cuenta @item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.C_cuentas_contables_g.nombre_cuenta</strong></td>
                    <td class="text-center">
                    </td>
                </tr>

                foreach (var entrega in item)
                {
                    decimal importe_entrega = (decimal)entrega.cantidad * (decimal)item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.costo;
                    <tr class="text-center">
                        <td></td>
                        <td class="text-left" style="width:300px;"><strong>Usuario surtió: @entrega.C_usuarios_corporativo.usuario</strong></td>
                        <td></td>
                        <td>@entrega.cantidad</td>
                        <td>$@item.FirstOrDefault().C_almacen_solicitudes_mercancia_d.costo.Value.ToString("N2")</td>
                        <td>$@importe_entrega.ToString("N2")</td>
                        <td></td>
                        <td>@string.Format(entrega.fecha_registro.Value.ToString(), "dd/MM/yyyy HH:MM:tt")</td>
                        <td>
                            @if (entrega.activo == true)
                            {
                                <button class="btn btn_beta_warning btn-xs" onclick="DevolucionVale(@entrega.id_solicitud_mercancia_d_log);"><i class="fa fa-undo"></i></button>
                            }
                            else
                            {
                                <h3 class="text-center text-danger">DEVUELTO</h3>
                            }
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
    <div class="container">
        <div id="div_devolucion_vale"></div>
    </div>
}
else
{
    <h3 class="text-center text-danger">VALE NO ENCONTRADO</h3>
}

