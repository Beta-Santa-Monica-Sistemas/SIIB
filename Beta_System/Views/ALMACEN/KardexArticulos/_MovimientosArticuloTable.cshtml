@model IEnumerable<Beta_System.Models.C_inventario_almacen_mov_d>

@if (Model != null)
{
    <table class="table table-striped table-bordered" id="tabla_kardex_articulos">
        <thead>
            <tr class="bg-beta text-center">
                <th>No. vale</th>
                <th>Clave art.</th>
                <th>Descripción</th>
                <th>Movimiento</th>
                <th>Equipo</th>

                <th>Fecha</th>
                <th>Centro</th>
                <th>Requisición</th>
                <th>Departamento</th>

                <th>Cantidad</th>

                <th>Rem./Fac.</th>
                <th>Proveedor</th>
                <th>Cargo</th>
                <th>Cuenta</th>

            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.ToList().OrderBy(x => x.fecha_registro))
            {
                <tr class="text-center">
                    <td>
                        @if (item.C_inventario_almacen_mov_g.C_almacen_solicitudes_mercancia_g != null)
                        {<strong>@item.C_inventario_almacen_mov_g.C_almacen_solicitudes_mercancia_g.id_solicitud_mercancia_g</strong>}
                    </td>

                    <td>@item.C_articulos_catalogo.clave</td>
                    <td class="text-left">@item.C_articulos_catalogo.nombre_articulo</td>
                    <td><strong style="color: @item.C_inventario_almacen_mov_g.C_inventario_mov_tipos.color;">@item.C_inventario_almacen_mov_g.C_inventario_mov_tipos.nombre_mov</strong></td>
                    <td>
                        @if (item.C_inventario_almacen_mov_g.C_almacen_solicitudes_mercancia_g != null)
                        {
                            <strong>@item.C_inventario_almacen_mov_g.C_almacen_solicitudes_mercancia_g.C_establos_equipos.clave_equipo</strong>
                        }
                    </td>


                    <td>@String.Format(item.fecha_registro.Value.ToShortDateString(), "dd/MM/yyyy")</td>

                    @if (item.C_inventario_almacen_mov_g.id_inventario_mov_tipo != 1002 && item.C_inventario_almacen_mov_g.id_inventario_mov_tipo != 3)
                    {
                        if (item.C_inventario_almacen_mov_g.C_almacen_solicitudes_mercancia_g != null)
                        {
                            <td>@item.C_inventario_almacen_mov_g.C_almacen_solicitudes_mercancia_g.C_centros_g.siglas</td>
                            <td></td>
                            <td>@item.C_inventario_almacen_mov_g.C_almacen_solicitudes_mercancia_g.C_departamentos_g.nombre_departamento</td>
                        }
                        else
                        {
                            if (item.C_inventario_almacen_mov_g.C_compras_ordenes_g != null)
                            {
                                <td>@item.C_inventario_almacen_mov_g.C_compras_ordenes_g.C_centros_g.siglas</td>
                                <td>@item.C_inventario_almacen_mov_g.C_compras_ordenes_g.id_requisicion_articulo_g</td>
                                <td></td>
                            }
                            else
                            {
                                <td></td>
                                <td></td>
                                <td></td>
                            }
                        }
                    }
                    else
                    {
                        <td></td>
                        <td></td>
                        <td></td>
                    }

                    <td><strong class="cantidad_surtida_kardex">@item.cantidad.Value.ToString("N2")</strong></td>

                    @if (item.C_inventario_almacen_mov_g.C_almacen_solicitudes_mercancia_g != null)
                    {
                        var solicitud_d = item.C_inventario_almacen_mov_g.C_almacen_solicitudes_mercancia_g.C_almacen_solicitudes_mercancia_d.Where(x => x.id_articulo == item.id_articulo && x.activo == true).FirstOrDefault();
                        <td></td>
                        <td></td>
                        try
                        {
                            <td>@solicitud_d.C_cargos_contables_g.nombre_cargo</td>
                            <td>@solicitud_d.C_cuentas_contables_g.cuenta @solicitud_d.C_cuentas_contables_g.nombre_cuenta</td>
                        }
                        catch (Exception)
                        {
                            string hola = "";
                            <td></td>
                            <td></td>
                        }
                    }
                    else
                    {
                        if (item.C_inventario_almacen_mov_g.C_compras_ordenes_g != null)
                        {
                            var orden_d = item.C_inventario_almacen_mov_g.C_compras_ordenes_g.C_compras_ordenes_d.Where(x => x.id_articulo == item.id_articulo && x.activo == true).FirstOrDefault();
                            <td>
                                @if (item.C_inventario_almacen_mov_g.C_compras_ordenes_g.C_compras_facturas_proveedores.Where(x => x.activo == true).Count() > 0)
                                {<label>@item.C_inventario_almacen_mov_g.C_compras_ordenes_g.C_compras_facturas_proveedores.FirstOrDefault().folio_factura</label> }
                            else
                            { @item.C_inventario_almacen_mov_g.folio_remi_fact}
                            </td>
                            <td>@item.C_inventario_almacen_mov_g.C_compras_ordenes_g.C_compras_proveedores.razon_social</td>
                            <td>@orden_d.C_cargos_contables_g.nombre_cargo</td>
                            <td>@orden_d.C_cuentas_contables_g.cuenta @orden_d.C_cuentas_contables_g.nombre_cuenta</td>
                        }
                        else
                        {
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        }
                    }


                </tr>
            }
        </tbody>
    </table>
}
else
{
    <h3 class="text-danger text-center">ERROR EN LA CONSULTA</h3>
}
