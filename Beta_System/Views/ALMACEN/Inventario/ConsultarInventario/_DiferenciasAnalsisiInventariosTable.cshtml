@model IQueryable<Beta_System.Models.C_inventario_almacen_captura_d>

@if (Model.Count() > 0)
{
    <table class="table table-striped table-bordered" id="datatable_inventario_diferencias">
        <thead>
            <tr class="bg-beta text-center">
                <th>Clave</th>
                <th>Articulo</th>
                <th>Cantidad sistema</th>
                <th>Fisico</th>
                <th>Diferencia</th>
                <th>Precio</th>
                <th>Importe</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.Where(x => x.diferencia != 0).GroupBy(x => x.C_inventario_almacen_captura_g.fecha_registro))
            {
                DateTime fechaInicio = item.FirstOrDefault().C_inventario_almacen_captura_g.fecha_registro.Value.Date;
                DateTime fechaFin = fechaInicio.AddDays(1).AddMinutes(-1);

                int articulos_totales = Model.Where(x => x.C_inventario_almacen_captura_g.fecha_registro >= fechaInicio && x.C_inventario_almacen_captura_g.fecha_registro < fechaFin).Count();

                <tr class="bg-green">
                    <td>@fechaInicio.ToShortDateString()</td>
                    <td>@item.FirstOrDefault().C_inventario_almacen_captura_g.observaciones</td>
                    <td>@item.Count() DE @articulos_totales</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                foreach (var detalle in item.OrderBy(x => x.C_articulos_catalogo.nombre_articulo))
                {
                    decimal importe = Convert.ToDecimal(detalle.C_articulos_catalogo.descripcion_articulo) * (decimal)detalle.diferencia;
                    <tr>
                        <td>@detalle.C_articulos_catalogo.clave</td>
                        <td>@detalle.C_articulos_catalogo.nombre_articulo</td>
                        <td>@detalle.cantidad_sistema.Value.ToString("N2")</td>
                        <td>@detalle.cantidad_captura.Value.ToString("N2")</td>
                        <td>@detalle.diferencia.Value.ToString("N2")</td>
                        <td>$@Convert.ToDecimal(detalle.C_articulos_catalogo.descripcion_articulo).ToString("N2")</td>
                        <td>$@importe.ToString("N2")</td>
                    </tr>
                }
            }
        </tbody>
    </table>
}
else
{
    <h3 class="text-center text-danger">NO SE ENCONTRARON INVENTARIOS REALIZADOS</h3>
}

