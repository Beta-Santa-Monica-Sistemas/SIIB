@model IEnumerable<Beta_System.Models.C_compras_ordenes_d>

@if (Model.Count() > 0)
{
    var modo = ViewBag.modo;
    var modelo = Model.FirstOrDefault();

    if (modo == 1)  //PRECARGA
    {
        var precarga = modelo.C_compras_ordenes_precarga_d.Where(x => x.activo == true && x.C_compras_ordenes_precarga_g.activo == true).FirstOrDefault();
        <div class="text-left">
            <h2 style="margin:0px;" class="bg-beta p-2 text-center">Orden de compra: @modelo.id_compras_orden_g </h2>

            <div class="col-md-6 text-left bg-dark" style="min-height: 6rem;">
                @try
                {
                    <h3 style="margin:10px;" class="text-white">Precargado por: @precarga.C_compras_ordenes_precarga_g.C_usuarios_corporativo.C_empleados.nombres @precarga.C_compras_ordenes_precarga_g.C_usuarios_corporativo.C_empleados.apellido_paterno</h3>
                    <h3 style="margin:10px;" class="text-white">Precargdo el dia: @string.Format(precarga.C_compras_ordenes_precarga_g.fecha_registro.Value.ToShortDateString(), "dd/mm/yyyy")</h3>
                }
                catch (Exception)
                {

                }
            </div>
            <div class="col-md-6 text-left bg-dark" style="min-height: 6rem;">
                <div class="row">
                    <div class="col-md-12">
                        <br />
                        <input type="text" class="form-control" id="factura_folio" placeholder="Ingresa el folio o remisión de la entrega" />
                    </div>
                </div>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-bordered w-100" id="tabla_recepcion" style="width:100%">
                <thead>
                    <tr class="bg-beta text-center">
                        <th>Recepcionar</th>
                        <th>Clave</th>
                        <th>Artículo</th>
                        <th>Unidad de medida</th>
                        <th>Solicitado</th>
                        <th>Entregado</th>
                        <th>Pendiente</th>
                        <th>Precargado</th>
                        <th>Recibe</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        var pendiente = item.cantidad_compra - item.cantidad_entregada;
                        var cant_precarga = item.C_compras_ordenes_precarga_d.Where(x => x.activo == true && x.C_compras_ordenes_precarga_g.recibido == false && x.C_compras_ordenes_precarga_g.activo == true).FirstOrDefault().cantidad_precarga;

                        <tr class="text-center">
                            <td>
                                @if (cant_precarga == 0)
                                {
                                    <strong class="text-danger">No enviado</strong>
                                }
                                else
                                { <input type="checkbox" value="@item.id_articulo" class="articulos_recepcion form-control" id="art_@item.id_compras_orden_d" style=" min-height: 25px;" onclick="HabilitarRecepcionArticulo(@item.id_compras_orden_d, @cant_precarga);" />}
                            </td>
                            <td>@item.C_articulos_catalogo.clave</td>
                            <td class="text-left">@item.C_articulos_catalogo.nombre_articulo</td>
                            <td>@item.C_unidades_medidas.unidad_medida</td>
                            <td>@string.Format("{0:0.00}", item.cantidad_compra)</td>
                            <td>@string.Format("{0:0.00}", item.cantidad_entregada)</td>
                            <td>@string.Format("{0:0.00}", pendiente)</td>
                            <td><strong id="pendiente_@item.id_compras_orden_d">@cant_precarga</strong></td>
                            <td>
                                <input class="form-control" id="art_cantidad_@item.id_compras_orden_d" disabled />
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }

    else
    {
        <h2 style="margin:0px;" class="bg-beta p-2 text-center">Orden de compra: @modelo.id_compras_orden_g </h2>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr class="bg-beta">
                        <th>Recepcionar</th>
                        <th>Articulo</th>
                        <th>Descripción</th>
                        <th>Unidad de medida</th>
                        <th>Cantidad compra</th>
                        <th>Cantidad recibida</th>
                        <th>Pendiente</th>
                        <th>Cantidad recepcion</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.Where(x => x.activo == true))
                    {
                        var pendiente = item.cantidad_compra - item.cantidad_entregada;
                        <tr class="text-center">
                            <td>
                                <input type="checkbox" value="@item.id_articulo" class="articulos_recepcion form-control" id="art_@item.id_compras_orden_d" style=" min-height: 25px; width: 40px;" onclick="HabilitarRecepcionArticulo(@item.id_compras_orden_d, @pendiente);" />
                            </td>
                            <td>@item.C_articulos_catalogo.clave</td>
                            <td>@item.C_articulos_catalogo.nombre_articulo</td>
                            <td>@item.C_unidades_medidas.unidad_medida</td>
                            <td>@string.Format("{0:0.00}", item.cantidad_compra)</td>
                            <td>@string.Format("{0:0.00}", item.cantidad_entregada)</td>
                            <td><label id="pendiente_@item.id_compras_orden_d">@string.Format("{0:0.00}", pendiente)</label></td>
                            <td>
                                <input class="form-control" id="art_cantidad_@item.id_compras_orden_d" disabled />
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div style="display: flex;">
            <div class="col-md-4 text-left bg-dark" style="min-height: 5rem;">
                <br />
                <h3 style="margin:10px;" class="text-white">Factura/Remisión (opcional)</h3>
            </div>
            <div class="col-md-4 text-left bg-dark" style="min-height: 5rem;">
                <br />
                <input type="text" class="form-control" id="factura_folio" placeholder="Ingresa el folio o remisión de la entrega" />
            </div>
        </div>
    }


    if (modelo.C_compras_ordenes_g.C_compras_ordenes_recepciones_g.Where(x => x.activo == true).Count() > 0)
    {
        <h3 style="margin:0px;" class="bg-beta text-center p-2">Recepciones anteriores</h3>
        <div style="height: 250px; overflow: auto; overflow-x: hidden;">
            @foreach (var recepcion in modelo.C_compras_ordenes_g.C_compras_ordenes_recepciones_g.Where(x => x.activo == true))
            {
                <div class="" id="heading_recepcion_@recepcion.id_compras_orden_recepcion_g">
                    <div class="w-100 collapsed">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <br />
                                <label>Recibió: @recepcion.C_usuarios_corporativo.usuario</label>
                            </div>
                            <div class="col-md-2 text-center pt-3">
                                <label>Fecha recepción:</label>
                                <br />
                                <strong>@string.Format(recepcion.fecha_registro.ToString(), "dd/mm/yyyy HH:MM")</strong>
                            </div>
                            <div class="col-md-2 text-center pt-3">
                                <label>Factura/Remisión</label>
                                <br />
                                <strong>@recepcion.factura_remision_folio</strong>
                            </div>
                            <div class="col-md-2 text-center pt-4">
                                <h4 class="mt-2">VER RECEPCIÓN</h4>
                            </div>
                            <div class="col-md-2 text-center pt-3">
                                <button class="btn btn_beta_icon" data-toggle="collapse" data-target="#collapse_@recepcion.id_compras_orden_recepcion_g" aria-expanded="false" aria-controls="collapse_@recepcion.id_compras_orden_recepcion_g"><i class="fa fa-bars"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="collapse_@recepcion.id_compras_orden_recepcion_g" class="collapse btn_detalle_requi_aut" aria-labelledby="heading_recepcion_@recepcion.id_compras_orden_recepcion_g" @*data-parent="#accordionSolicitudes"*@>
                    <div class="table-responsive text-dark text-white table-hover table-sm">
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr class="bg-beta">
                                    <th>Clave</th>
                                    <th>Articulo</th>
                                    <th>Cantidad</th>
                                    <th>Unidad medida</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var det in recepcion.C_compras_ordenes_recepciones_d)
                                {
                                    <tr>
                                        <td>@det.C_compras_ordenes_d.C_articulos_catalogo.clave</td>
                                        <td>@det.C_compras_ordenes_d.C_articulos_catalogo.nombre_articulo</td>
                                        <td>@det.cantidad_recepcion.Value.ToString("N2")</td>
                                        <td>@det.C_compras_ordenes_d.C_articulos_catalogo.C_unidades_medidas.unidad_medida</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
        </div>
    }
}
else
{
    <h3 class="text-center text-danger">NO SE ENCONTRARON REGISTROS</h3>
}
