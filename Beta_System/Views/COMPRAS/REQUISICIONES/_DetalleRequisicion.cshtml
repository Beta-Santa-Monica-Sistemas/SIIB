@model IEnumerable<Beta_System.Models.C_compras_requi_d>

@{
    var requi = Model.FirstOrDefault().C_compras_requi_g;

    var firma = ViewBag.firmas;
    var monto = ViewBag.monto_usuario;
    decimal importe_total = 0;
    Html.RenderAction("ConsultarInformacionRequisicionHeader", "REQUISICIONES", new { id_requisicion = requi.id_requisicion_articulo_g });
}

<h3 class="text-center" style="margin: 0px;">Detalle de la requisición</h3>
<hr />
<div class="table-responsive">
    <table class="table table-striped table-bordered table-sm small table-hover">
        <thead>
            <tr class="text-center bg-beta">
                <th>Cta. autorizada</th>
                <th>Clave</th>
                <th style="width:20%;">Artículo</th>
                <th>Unidad</th>
                <th>Precio</th>
                <th>Cantidad</th>
                <th>Importe</th>
                <th style="width:20%;">Cargo Contable</th>
                <th style="width:20%;">Cuenta Contable</th>
                <th style="width:40%;">Observaciones</th>
                <th>Editar</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                var importe = item.precio * item.cantidad;
                importe_total += (decimal)importe;
                <tr class="text-center">
                    <td>
                        @if (item.recotizado == true)
                        {<i class="fa fa-2x fa-check" style="color:lawngreen;"></i> }
                        else
                        { <i class="fa fa-2x fa-remove" style="color:red;"></i>}
                    </td>
                    <td>@item.C_articulos_catalogo.clave</td>
                    <td class="text-left" style="width:20%;">@item.C_articulos_catalogo.nombre_articulo</td>
                    <td>@item.C_unidades_medidas.unidad_medida</td>
                    <td>$@item.precio.Value.ToString("N2") </td>
                    <td>@string.Format("{0:0.00}", @item.cantidad)</td>
                    <td>$@importe.Value.ToString("N2") </td>
                    <td>@item.C_cargos_contables_g.nombre_cargo</td>

                    <td style="width:20%;">@item.C_cuentas_contables_g.cuenta - @item.C_cuentas_contables_g.nombre_cuenta</td>
                    <td class="text-left" style="width:40%;">@item.observacion</td>
                    <td>
                        <button class="btn btn_beta_lineal" onclick="EditarArticuloRequisicionAuth(@item.id_requisicion_articulo_d, @item.id_cargo_contable, @item.id_cuenta_contable_g, @item.cantidad, '@item.observacion', '@item.C_articulos_catalogo.nombre_articulo', @item.C_compras_requi_g.id_requisicion_tipo, @item.id_articulo, @item.id_requisicion_articulo_g);"><i class="fa fa-edit"></i></button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
<h5 class="bg-dark text-white" style="padding:5px; margin:0px;"><strong>Importe Total $ <strong class="ml-3">@importe_total.ToString("N2")</strong></strong></h5>
<br />
<br />


@if (requi.aut_2_status == null && requi.aut_1_status != null)
{
    <div class="col-md-12">
        <div class="col-md-10"></div>
        <div class="col-md-2 text-center" style="font-size: 18px; background-color: #2E87D7; color: white;">
            <strong>Monto de autorización</strong><br />
            <strong>$@monto.ToString("#,##0.00") MXN</strong>
        </div>
    </div>
}
@if (requi.aut_1_status != null)
{
    <div class="col-md-12">
        <strong>Resumen de presupuesto por cuenta</strong>
    </div>
    Html.RenderAction("ConsultarResumenPresupuestoCuentaRequi", "REQUISICIONES", new { id_requi = requi.id_requisicion_articulo_g });
}

@{
    switch (firma)
    {
        case 1:
            <div class="row">
                <div class="col-md-4 text-left">
                    <br /><br />
                    <button class="btn btn_beta" id="btn_aut_requi_autorizar"><i class="fa fa-check"></i> AUTORIZAR</button>
                    <button class="btn btn_beta_danger ml-5" id="btn_aut_requi_no"><i class="fa fa-remove"></i> RECHAZAR</button>
                </div>
            </div>
            break;
        case 2:
            <div class="row">
                <div class="col-md-4 text-left">
                    <br /><br />
                    <button class="btn btn_beta" id="btn_aut_requi_autorizar"><i class="fa fa-check"></i> AUTORIZAR</button>
                    <button class="btn btn_beta_danger ml-5" id="btn_aut_requi_no"><i class="fa fa-remove"></i> RECHAZAR</button>
                </div>
            </div>
            break;
        case 3:
            <div class="row">
                <div class="col-md-4 text-left">
                    <br /><br />
                    <button class="btn btn_beta" id="btn_aut_requi_autorizar"><i class="fa fa-check"></i> AUTORIZAR</button>
                    <button class="btn btn_beta_danger ml-5" id="btn_aut_requi_no"><i class="fa fa-remove"></i> RECHAZAR</button>
                </div>
            </div>
            break;
        case 4:
            <div class="row">
                <div class="col-md-4 text-left">
                    <br /><br />
                    <button class="btn btn_beta" id="btn_aut_requi_autorizar"><i class="fa fa-check"></i> AUTORIZAR</button>
                    <button class="btn btn_beta_danger ml-5" id="btn_aut_requi_no"><i class="fa fa-remove"></i> RECHAZAR</button>
                </div>
            </div>
            break;
        case 5:
            <div class="row">
                <div class="col-md-4 text-left">
                    <h2 class="text-center text-danger">Este usuario no puede autorizar requisiciones de inversión</h2>
                </div>
            </div>
            break;

        case 6:
            <div class="row">
                <div class="col-md-4 text-left">
                    <h2 class="text-center text-danger">Una de las cuenta no está asignada a este usuario</h2>
                </div>
            </div>
            break;

        default:
            break;
    }
}

@*@{ Html.RenderAction("ConsultarTrackingRequisicion", "REQUISICIONES", new { id_requisicion_g = requi.id_requisicion_articulo_g }); }*@
