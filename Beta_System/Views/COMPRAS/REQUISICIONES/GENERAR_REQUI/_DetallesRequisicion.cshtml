@model IEnumerable<Beta_System.Models.C_compras_requi_d>

@if (Model.Count() > 0)
{
    var firma = ViewBag.firmas;
    var monto = ViewBag.monto_usuario;
    decimal importe_total = 0;
    int id_usuario = ViewBag.id_usuario;
    bool propietario_requi = false;
    if (Model.FirstOrDefault().C_compras_requi_g.id_usuario_registro == id_usuario) { propietario_requi = true; }

    Html.RenderAction("ConsultarInformacionRequisicionHeader", "REQUISICIONES", new { id_requisicion = Model.FirstOrDefault().id_requisicion_articulo_g });
    
    
    
    <div class="row">
        <div class="col-md-4">
            <strong>Detalle de la requisición</strong>
        </div>
        <div class="col-md-8 text-right">
            @if (propietario_requi == true && Model.FirstOrDefault().C_compras_requi_g.id_requisicion_tipo == 2 && Model.FirstOrDefault().C_compras_requi_g.C_compras_ordenes_g.Where(x => x.activo == true).Count() == 0)
            {
                <button class="btn btn_beta_warning" onclick="AddArticuloRequisicionServicio(@Model.FirstOrDefault().C_compras_requi_g.id_requisicion_articulo_g, @Model.FirstOrDefault().C_compras_requi_g.id_requisicion_tipo);"><i class="fa fa-plus"></i> Agregar servicio</button>
            }
            </div>
    </div>
    <div class="table-responsive" style="height: 350px; min-height: 350px; overflow-x: auto; overflow-y: auto;">
        <table class="table table-striped table-bordered text-center table-sm small" id="datatable_detalle_requisicion_general">
            <thead>
                <tr class="bg-beta">
                    <th>Artículo</th>
                    <th style="width:20%;">Descripción</th>
                    <th>Unidad</th>
                    <th>Precio</th>
                    <th>Cantidad</th>
                    <th>Importe</th>
                    <th>Cargo Contable</th>
                    <th>Cuenta Contable</th>
                    <th style="width:40%;">Observaciones</th>
                    @if (propietario_requi == true && Model.FirstOrDefault().C_compras_requi_g.id_requisicion_tipo == 2 && Model.FirstOrDefault().C_compras_requi_g.C_compras_ordenes_g.Where(x => x.activo == true).Count() == 0)
                    {
                        <th>Editar</th>
                        <th>Eliminar</th>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    var importe = item.precio * item.cantidad;
                    importe_total += (decimal)importe;
                    <tr class="text-center">
                        <td>@item.C_articulos_catalogo.clave</td>
                        <td class="text-left" style="width:20%;">
                            <h6>@item.C_articulos_catalogo.nombre_articulo</h6>

                            @try
                            {
                                if (Model.FirstOrDefault().C_compras_requi_g.id_requisicion_tipo == 2 && Model.FirstOrDefault().C_compras_requi_g.C_compras_ordenes_g.Where(x => x.activo == true).Count() == 0)
                                {
                                    <span>
                                        <i>Prov: @item.C_compras_cotizaciones_requisiciones.Where(x => x.agrupada == true).FirstOrDefault().C_compras_cotizaciones_articulos.C_compras_proveedores.razon_social</i>
                                    </span>
                                }

                            }
                            catch (Exception)
                            {

                            }

                        </td>
                        <td>@item.C_unidades_medidas.unidad_medida</td>
                        <td>$@item.precio.Value.ToString("N2")</td>
                        <td>@string.Format("{0:0.00}", @item.cantidad)</td>
                        <td>$@importe.Value.ToString("N2")</td>
                        <td>@item.C_cargos_contables_g.nombre_cargo</td>
                        <td>@item.C_cuentas_contables_g.cuenta @item.C_cuentas_contables_g.nombre_cuenta</td>
                        <td class="text-left" style="width:40%;">@item.observacion.ToUpper()</td>
                        @if (propietario_requi == true && Model.FirstOrDefault().C_compras_requi_g.id_requisicion_tipo == 2 && Model.FirstOrDefault().C_compras_requi_g.C_compras_ordenes_g.Where(x => x.activo == true).Count() == 0)
                        {
                            <td><button class="btn btn_beta_warning_icon" onclick="EditarArticuloRequisicionAuth(@item.id_requisicion_articulo_d, @item.id_cargo_contable, @item.id_cuenta_contable_g, @item.cantidad, '@item.observacion', '@item.C_articulos_catalogo.nombre_articulo', @item.C_compras_requi_g.id_requisicion_tipo, @item.id_articulo, @item.id_requisicion_articulo_g);"><i class="fa fa-edit"></i></button></td>
                            <td><button class="btn btn_beta_danger_icon" onclick="EliminarArticuloRequisicionServicio(@item.id_requisicion_articulo_d, @item.id_requisicion_articulo_g, @item.id_articulo);"><i class="fa fa-remove"></i></button></td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <h5 class="bg-dark text-white" style="padding:5px; margin:0px;"><strong>Importe Total $ <strong class="ml-3">@importe_total.ToString("N2")</strong></strong></h5>

    Html.RenderAction("ConsultarTrackingRequisicion", "REQUISICIONES", new { id_requisicion_g = Model.FirstOrDefault().id_requisicion_articulo_g });

    Html.RenderAction("ConsularTrackingLogRequisicion", "REQUISICIONES", new { id_requisicion_g = Model.FirstOrDefault().id_requisicion_articulo_g });
}
else
{
    <h3 class="text-center text-danger">OCURRIÓ UN ERROR EN LA CONSULTA</h3>
}




