@model IEnumerable<Beta_System.Models.C_compras_cotizaciones_articulos>
@if (Model.Count() == 0)
{
    <h2 class="text-center text-danger">SIN HISTORIAL DE COTIZACIONES</h2>
}
else
{
    var articulo = Model.FirstOrDefault().C_articulos_catalogo;
    <h2 class="text-center">Historial de cotizaciones:</h2>
    <div class="row">
        <div class="col-md-6 text-left">
            <h4 style="margin:0px;">Artículo:</h4>
            <h3 style="margin:0px;">@articulo.nombre_articulo</h3>
        </div>

        <div class="col-md-2 text-left">
            <h4 style="margin:0px;">Unidad de medida: </h4>
            <h3 style="margin:0px;">@articulo.C_unidades_medidas.unidad_medida</h3>

            <label id="unidad_medida" style="display:none;">@articulo.id_unidad_medida</label>
            <label id="requi_d_hist" style="display:none"></label>
            <label id="articulo_hist" style="display:none">@articulo.id_articulo</label>
        </div>

        <div class="col-md-2 text-left">
            <h4 style="margin:0px;">Cantidad:</h4>
            <h3 style="margin:0px;" id="cantidad_articulo_hist"></h3>
        </div>

        <div class="col-md-2 text-left row">
            <h4 style="margin:0px;">Precio final: </h4>
            <h3 style="margin: 0px;" id="precio_final">...</h3><label class="ml-2" style="font-size: 18px; font-weight: 500;">MXN</label>
        </div>
    </div>
    <hr />
    <table class="table table-striped table-bordered" id="datatable_articulos_coti" style="width:100%;">
        <thead>
            <tr class="bg-beta text-center">
                <th>Proveedor</th>
                <th>Registro</th>
                <th>Vigencia</th>
                <th>Precio</th>
                <th>Moneda</th>
                <th>Descuento</th>
                <th>Editar vigencia</th>
                <th>Asignar</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                TimeSpan diferencia;
                var indicador_vigencia = false;
                string class_test = "text_beta";
                try
                {
                    diferencia = (DateTime)item.fecha_vigencia.Value - (DateTime)item.fecha_cotizacion;
                    if (diferencia.TotalDays <= 30) { indicador_vigencia = true; }
                }
                catch (Exception)
                {
                    indicador_vigencia = false;
                }

                <tr class="text-center">
                    <td>@item.C_compras_proveedores.razon_social</td>
                    <td>@String.Format(item.fecha_cotizacion.Value.ToShortDateString(), "dd/mm/aaaa")</td>
                    <td>
                        @if (indicador_vigencia == true)
                        {
                            <strong class="text-danger">@String.Format(item.fecha_vigencia.Value.ToShortDateString(), "dd/mm/aaaa")</strong><br />
                            <span class="text-secondary text-sm">(Vence pronto)</span>
                        }
                        else
                        {
                            <strong class="text_beta">@String.Format(item.fecha_vigencia.Value.ToShortDateString(), "dd/mm/aaaa")</strong>
                        }
                    </td>
                    <td><strong>$@item.precio_unitario.Value.ToString("N9")</strong></td>
                    <td>@item.C_tipos_moneda.clave_fiscal</td>
                    @if (item.porcentaje_descuento > 0)
                    {
                        <td id="@item.porcentaje_descuento"><strong>@Math.Round((double)item.porcentaje_descuento)%</strong></td>
                    }
                    else
                    {
                        <td id="0" style="color: red"><i class="fa fa-times"></i></td>
                    }
                    <td><button class="btn btn_beta_icon" onclick="ModificarVigenciaProveedor(@item.id_compra_articulo_cotizacion);"><i class="fa fa-bars"></i></button></td>
                    <td><button class="btn btn_beta_icon" onclick="AsignarPorHistorial(@item.id_compra_articulo_cotizacion,@item.C_compras_proveedores.id_compras_proveedor);"><i class="fa fa-plus"></i></button></td>
                </tr>
            }
        </tbody>
    </table>
    <div class="col-md-12 text-right">
        <button type="button" class="btn btn_beta_danger" data-dismiss="modal">Cerrar</button>
    </div>
}